<!DOCTYPE>
<html>
<head>
    <title>CHIP</title>
    <link rel="stylesheet" href="chip-style.css">
</head>
<body>

    <form method="post" action="SetFace">
        <label for="Faces">Choose a Face:</label>
        <select name="Faces" id="chip-faces" onchange="onSelectChange()">
            <option value="Happy face"></option>
            <option value="Happy face">Happy face</option>
            <option value="Sad face">Sad face</option>
            <option value="Angry face">Angry face</option>
            <option value="What face">What face</option>
            <option value="Flag face">Flag face</option>
            <!-- <option value="Gif face">Gif face</option> -->
            <option value="Shock face">Shock face</option>
            <!-- <option value="Snake face">Snake face</option> -->
            <option value="Overheat face">Overheat face</option>
            <!-- <option value="Cwood face">Cwood face</option> -->
            <option value="Lowbatt face">Lowbatt face</option>
            <option value="Pacman face">Pacman face</option>
            <option value="Matrix face">Matrix face</option>
            <!-- <option value="8 Ball Face">8 Ball Face</option> -->
            <!-- <option value="SHAKE BALL">SHAKE BALL</option> -->
            <option value="HALLOWEEN FACE">HALLOWEEN FACE</option>
            <option value="LOVE FACE">LOVE FACE</option>
            <option value="textTest face">textTest face</option>
            <option value="DvD face">DvD face</option>
            <option value="matrix rain">matrix rain</option>
        </select>
        <!--<input type="submit" value="SetFace">-->
    </form>
    <form method="post" action="SetTextFace">
        <label for="Faces">write text to Face:</label>
        <input type="text" id="ftext" name="ftext"><br>
        <label for="Faces">delay:</label>
        <input type="range" id="speed" name="speed" min="1" max="50"><br>
        <label for="Faces">colour:</label>
        <input type="color" id="color" name="color" value="#ffffff"><br>
        <input type="checkbox" id="leftToRight" name="leftToRight" value="ltr">
        <label for="Faces"> scroll right</label><br>
        <input type="submit" value="SetTextFace">
    </form>

    <section class="container">
        <div id="toolbar">
            <h1>Draw.</h1>
            <label for="stroke">Stroke</label>
            <input id="stroke" name='stroke' type="color">
            <label for="lineWidth">Line Width</label>
            <input id="lineWidth" name='lineWidth' type="number" value="5">
            <button id="clear">Clear</button>
            <button id="push">Push</button>
        </div>
        <div class="drawing-board">
            <canvas id="canvas"></canvas>
        </div>
    </section>
   


</body>

</html>
<script>
    function onSelectChange(event) {

        selectElement = document.querySelector('#chip-faces');
        selectElement.form.submit();
    };
    function copy() {
        const imgData = ctx.getImageData(10, 10, 50, 50);
    }
    toolbar.addEventListener('click', e => {
        if (e.target.id === 'push') {
            pushData();
        }
    });

    function pushData() {
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "rawrdata", true);
        xhttp.send(prep());
    }

    function prep() {
        var prepimgdata = ctx.getImageData(0, 0, 32, 64)
        let str = '';

        for (let i = 0; i < 8192; i+=4) {
            let red = prepimgdata.data[i];
            let green = prepimgdata.data[i+1];
            let blue = prepimgdata.data[i+2];
            let alpha = prepimgdata.data[i+3];

            str = str + rgbToHex(red,green,blue)+',';
        }
        return str;
    }
    function componentToHex(c) {
        var hex = c.toString(16);
        return hex.length == 1 ? "0" + hex : hex;
    }
    function rgbToHex(r, g, b) {
        return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
    }


    //var canvas = document.createElement('canvas');
    //canvas.id = "canvas";
    //document.body.appendChild(canvas);

    document.body.style.margin = 0;
    canvas.style.position = 'relative';

    var ctx = canvas.getContext('2d');
    resize();

    var pos = {
        x: 0,
        y: 0
    };
    var buttonDown = false;

    const cvs = document.getElementById("canvas");
    cvs.addEventListener('mousedown', getRandomInt);
    cvs.addEventListener('touchstart', getRandomInt);

    window.addEventListener('resize', resize);

    document.addEventListener('mousemove', draw);
    document.addEventListener('mousedown', setPosition);
    document.addEventListener('mouseup', released);

    document.addEventListener('touchstart', setPosition);
    document.addEventListener('touchmove', draw);
    document.addEventListener('touchend', released);

    function getRandomInt() {
        window.randInt = Math.floor(Math.random() * Math.floor(3));
    }

    function released(e) {
        buttonDown = false;
    }

    function setPosition(e) {
        if (e.type == "touchstart" || e.type == "mousedown") {
            buttonDown = true;
        }
        if (e.type == "touchstart" || e.type == "touchmove") {
            pos.x = e.touches[0].clientX - 70;
            pos.y = e.touches[0].clientY - 150;
        } else {
            pos.x = e.clientX - 70;
            pos.y = e.clientY - 150;
        }
    }

    function resize() {
        ctx.canvas.width = window.innerWidth;
        ctx.canvas.height = window.innerHeight;
    }

    function draw(e) {
        if (!buttonDown) return;
        ctx.beginPath();

        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.strokeStyle = document.getElementById("stroke").value;

        ctx.moveTo(pos.x, pos.y);
        setPosition(e);
        ctx.lineTo(pos.x, pos.y);

        ctx.stroke();
    }



</script>